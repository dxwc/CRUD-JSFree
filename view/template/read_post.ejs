<?- include('./common/layout_pre.ejs', { title : 'Post', name : locals.name }) ?>

<? if
(
    locals.post &&
    locals.post.id &&
    locals.post.content &&
    locals.post.by &&
    locals.post.createdAt &&
    locals.post.updatedAt
) { ?>
<p><?- post.content ?></p>
<? if
(
    locals.name !== false &&
    locals.post.by === locals.name
) { ?>
<form method='GET' action='/post/<?= post.id ?>/update'>
    <input type='hidden' name='username' value='<?= post.by ?>'>
    <button type='submit'>Edit</button>
</form>
<form method='GET' action='/post/<?= post.id ?>/delete'>
    <input type='hidden' name='username' value='<?= post.by ?>'>
    <button type='submit'>Delete</button>
</form>
<? } ?>
<? if(locals.name !== false) { ?>
<form
    method='GET'
    action='/contact/<?= locals.post.self_link ? post.self_link : "" ?>'>
    <button type='submit'>Report</button>
</form>
<form method='POST' action='/comment'>
    <input name='post_id' type='hidden' value='<?= post.id ?>'>
    <input name='post_content' type='hidden' value='<?= post.content ?>'>
    <div>
        <label for='comment_w'>Write your comment here:</label>
    </div>
    <div>
        <textarea
            name='comment_w'
            type='text'
            placeholder='Enter your comment here'
            minlength='1'
            autocomplete='off'
            required><? if(locals.comment_w){ ?><?= comment_w ?><? } ?></textarea>
    </div>
    <? if(locals.info) { ?>
        <div>
            <?= info ?>
        </div>
    <? } ?>
    <button type='submit'>Submit</button>
</form>
<? } ?>
<div>
    Posted by <?= post.by ?>
</div>
<div>
    <p>Posted at <?= post.createdAt ?></p>
    <p>Updated at <?= post.updatedAt ?></p>
</div>
<? if(locals.comments && comments.constructor === Array) { ?>
    <style>
        .comment
        {
            border: 1px solid #ddd;
            padding: 1%;
            margin: 1%;
        }
        .right
        {
            float: right;
        }
    </style>
    <? comments.forEach((c) => { ?>
        <div id='<?= c.id ?>' class='comment'>
            <p><?- c.content ?></p>
            By: <a href='/user/<?= c.commenter ?>'><?= c.commenter ?></a>
            <a class='right' href='/post/<?= post.id ?>#<?= c.id ?>'>link</a>
        </div>
    <? }); ?>
<? } ?>
<? } else { ?>
    Could not find any such post
<? } ?>

<?- include('./common/layout_post.ejs') ?>